if not listexists 'vampiric_embraced_corpses'
    sysmsg '>>> Creating list to control consumed (vamp embraced) corpses...' 74
    createlist 'vampiric_embraced_corpses'
endif

if skill 'spirit' > 0 and not listexists 'drained_corpses'
    sysmsg '>>> Creating list to control drained corpses...' 74
    createlist 'drained_corpses'
endif

# CHOOSE CHARACTER SUMMONS
if not listexists 'summons'
    createlist 'summons'
else
    clearlist 'summons'
endif

# CHOOSE CHARACTER SUMMONS
if not listexists 'found_summon'
    createlist 'found_summon'
endif

# CHOOSE CHARACTER SUMMONS
if not listexists 'found_undead_summon'
    createlist 'found_undead_summon'
else
    clearlist 'found_undead_summon'
endif

if not listexists 'make_undead_summon'
    createlist 'make_undead_summon'
else
    clearlist 'make_undead_summon'
endif

if not listexists 'cast_summon_spell'
    createlist 'cast_summon_spell'
else
    clearlist 'cast_summon_spell'
endif

@pushlist 'summons' 'an earth elemental'
@pushlist 'summons' 'a fire elemental'

foreach summon in 'summons'

    # determine summon name by whether char has necromancy or not
    clearlist 'make_undead_summon'
    if skill 'necromancy' >= 50
        # on each iteration, clear and populate this list to set the undead alternative summon based on current summon
        if not listexists 'undead_summons'
            createlist 'undead_summons'
        else
            clearlist 'undead_summons'
        endif

        if earth in summon
            pushlist 'undead_summons' 'an ancient mummy'
            pushlist 'make_undead_summon' 'yes'
        elseif fire in summon
            pushlist 'undead_summons' 'a lich'
            pushlist 'make_undead_summon' 'yes'
        elseif air in summon
            pushlist 'undead_summons' 'a skeletal fiend'
            pushlist 'make_undead_summon' 'yes'
        elseif daemon in summon
            pushlist 'undead_summons' 'a vampire thrall'
            pushlist 'make_undead_summon' 'yes'
        elseif water in summon
            pushlist 'undead_summons' 'a rag witch'
            pushlist 'make_undead_summon' 'yes'
        endif
    endif

    #########################
    # try to find a similir creature summon to see if we need to cast this one or skip to next one
    clearlist 'found_summon'
    clearlist 'found_undead_summon'
    clearlist 'cast_summon_spell'
    if findtype summon ground any 1 7 as summonserial
        if noto summonserial = friend
            overhead '| summon |' 72 summonserial
            pushlist 'found_summon' 'yes'
        endif
    # if the 'undead_summons' list has elements, we need to check for those undead summons as well
    elseif list 'undead_summons' > 0
        foreach necro_summon in 'undead_summons'
            if findtype necro_summon ground any 1 7 as summonserial
                if noto summonserial = friend
                    overhead '| undead summon |' 72 summonserial
                    pushlist 'found_undead_summon' 'yes'
                endif
            endif
        endfor
    endif

    if inlist 'found_summon' 'yes'
        if skill 'spirit' > 0
            if findtype 'corpse' ground any any 10 as body
                if not inlist 'drained_corpses' body
                    sysmsg '>>> DRANING NEARBY CORPSES' 55
                    skill 'spirit'
                    @pushlist 'drained_corpses' body
                    @ignore body
                endif
            else
                overhead '*no corpses nearby to drain*' 56
            endif
        endif
    else
        if skill 'spirit' > 0 and skill 'necromancy' == 0
            overhead '*no summons to extend*' 56
        endif
    endif

    if inlist 'found_undead_summon' 'yes'
        # keep draining corpses within 10 tile range
        if skill 'necromancy' > 0
            if findtype 'corpse' ground any any 10 as body
                if not inlist 'vampiric_embraced_corpses' body
                    say '[vampiricembrace'
                    wft action_delay
                    if targetexists 'neutral'
                        sysmsg '>>> CONSUMING NEARBY CORPSE...' 95
                        overhead '*consuming corpse*' 95
                        target body
                        @pushlist 'vampiric_embraced_corpses' body
                    endif

                    wait action_delay
                endif
            else
                overhead '*no corpses nearby to consume*' 56
            endif
        endif

    else
        overhead '*no undeads to heal*' 56

    endif
endfor
