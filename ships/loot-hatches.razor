
################################
# SCRIPT CONFIGURATION
################################

setvar! action_delay 600



# RARES
if not listexists 'rares'
    sysmsg 'Creating rares list...' 51
    createlist 'rares'
    pushlist 'rares' 'folded cloth' //rare_cloths
    pushlist 'rares' 'aspect core'
    pushlist 'rares' 'map'
    pushlist 'rares' 5359 //spell_hue_deeds
    pushlist 'rares' 22336 //skill_orbs
    pushlist 'rares' 17087 //mcds
    pushlist 'rares' 'research materials' //research_materials
    pushlist 'rares' 'scroll of calling' //skill_scrolls
    pushlist 'rares' 3836 //aspect_extract
    pushlist 'rares' 'phylactery'
    pushlist 'rares' 3838 //runebook_dye
    pushlist 'rares' 3839 //backpack_dye
    pushlist 'rares' 3842 //headwear_dye
    pushlist 'rares' 3843 //facial_hair_dye
    pushlist 'rares' 3843 //acessory_dye
    pushlist 'rares' 29025 //fortuniture_dye
    pushlist 'rares' 29036 //carpet_dye
endif

# ARCANE RUNES
if not listexists 'arcane_runes'
    sysmsg 'Creating arcane runes list...' 51
    createlist 'arcane_runes'
    pushlist 'arcane_runes' 39891
    pushlist 'arcane_runes' 39892
    pushlist 'arcane_runes' 39917
    pushlist 'arcane_runes' 39909
    pushlist 'arcane_runes' 39912
    pushlist 'arcane_runes' 39905
    pushlist 'arcane_runes' 39911
    pushlist 'arcane_runes' 39897
    pushlist 'arcane_runes' 39918
    pushlist 'arcane_runes' 39889
    pushlist 'arcane_runes' 39898
    pushlist 'arcane_runes' 39896
    pushlist 'arcane_runes' 39916
endif

# MISC HATCH ITEMS
if not listexists 'hatch_items'
    sysmsg 'Creating regular hatch items list...' 51
    createlist 'hatch_items'

    pushlist 'hatch_items' 'blank scroll%s%' //arcane_scrolls
    pushlist 'hatch_items' 29030 //plant_chemicals
    pushlist 'hatch_items' 'gold coin'
    pushlist 'hatch_items' 'bow'
    pushlist 'hatch_items' 'seed of renewal'
    pushlist 'hatch_items' 'bag of seeds'


    # gems
    @pushlist 'hatch_items' 'rub%ies/y%'
    @pushlist 'hatch_items' 'tourmaline%s%'
    @pushlist 'hatch_items' 'emerald%s%'
    @pushlist 'hatch_items' 'diamond%s%'
    @pushlist 'hatch_items' 'piece%s% of amber'
    @pushlist 'hatch_items' 'amethyst%s%'
    @pushlist 'hatch_items' 'star sapphire%s%'
    @pushlist 'hatch_items' 'citrine%s%'
    @pushlist 'hatch_items' 'sapphire%s%'


    pushlist 'hatch_items' 'spellbook'

    pushlist 'hatch_items' 'martial arts scroll' //wrestle_martial_manual

    # ARCHERY WEAPONS
    pushlist 'hatch_items' 'bow'
    pushlist 'hatch_items' 'crossbow'
    pushlist 'hatch_items' 'heavy crossbow'

    # SWORDS WEAPONS
    pushlist 'hatch_items' 'cutlass'
    pushlist 'hatch_items' 'katana'
    pushlist 'hatch_items' 'viking sword'
    pushlist 'hatch_items' 'broadsword'
    pushlist 'hatch_items' 'longsword'
    pushlist 'hatch_items' 'double axe'
    pushlist 'hatch_items' 'two handed axe'
    pushlist 'hatch_items' 'battle axe'
    pushlist 'hatch_items' 'bardiche'
    pushlist 'hatch_items' 'halberd'
    pushlist 'hatch_items' "executioner's axe"

    # MACING WEAPONS
    pushlist 'hatch_items' 'club'
    pushlist 'hatch_items' 'mace'
    pushlist 'hatch_items' 'war mace'
    pushlist 'hatch_items' 'war axe'
    pushlist 'hatch_items' 'hammer pick'
    pushlist 'hatch_items' 'black staff'
    pushlist 'hatch_items' 'gnarled staff'
    pushlist 'hatch_items' 'quarter staff'
    pushlist 'hatch_items' 5177 //war_hammer
    pushlist 'hatch_items' 'maul'
    # sheps crook
    pushlist 'hatch_items' 3713 //sheps_crook

    # FENCING WEAPONS
    pushlist 'hatch_items' 'kryss'
    pushlist 'hatch_items' 'war fork'
    pushlist 'hatch_items' 'short spear'
    pushlist 'hatch_items' 'Long Spear'
    pushlist 'hatch_items' 'pitchfork'
    pushlist 'hatch_items' 'bladed staff'

    # SHIELDs
    pushlist 'hatch_items' 7027 //bucker
    pushlist 'hatch_items' 'buckler'
    pushlist 'hatch_items' 'wooden shield'
    pushlist 'hatch_items' 'metal shield'
    pushlist 'hatch_items' 7026 //bronze_shield
    pushlist 'hatch_items' 7033 //kite_shield
    pushlist 'hatch_items' 7029 //metal_kite_shield
    pushlist 'hatch_items' 'heater shield'

    # HATS
    pushlist 'hatch_items' "wizard's hat"

    # BONE SET
    pushlist 'hatch_items' 'bone armor'
    pushlist 'hatch_items' 'bone gorget'
    pushlist 'hatch_items' 'bone arms'
    pushlist 'hatch_items' 'bone gloves'
    pushlist 'hatch_items' 'bone legs'

    # LEATHER SET
    pushlist 'hatch_items' 'leather cap'
    pushlist 'hatch_items' 'leather tunic'
    pushlist 'hatch_items' 'leather gorget'
    pushlist 'hatch_items' 'leather sleeves'
    pushlist 'hatch_items' 'leather gloves'
    pushlist 'hatch_items' 'leather leggings'
    pushlist 'hatch_items' 'leather skirt'
    pushlist 'hatch_items' 'leather bustier'
    pushlist 'hatch_items' 'leather shorts'
    pushlist 'hatch_items' 'leather armor'


    # STUDDED SET
    pushlist 'hatch_items' 'studded tunic'
    # studded armor (doenst work with only name)
    pushlist 'hatch_items' 7170
    pushlist 'hatch_items' 'studded armor'
    pushlist 'hatch_items' 'studded sleeves'
    pushlist 'hatch_items' 'studded leggings'
    pushlist 'hatch_items' 'studded gorget'
    pushlist 'hatch_items' 'studded gloves'
    pushlist 'hatch_items' 'studded bustier'

    # HELMETS
    pushlist 'hatch_items' 'helmet'
    pushlist 'hatch_items' 'norse helm'
    pushlist 'hatch_items' 'close helm'
    # bascinet doenst work with name appearantly
    pushlist 'hatch_items' 5135
    pushlist 'hatch_items' 'bascinet'
    pushlist 'hatch_items' 'bone helmet'
    pushlist 'hatch_items' 'plate helm'

    # PLATEMAIL SET
    pushlist 'hatch_items' 'platemail'
    pushlist 'hatch_items' 'platemail arms'
    pushlist 'hatch_items' 'platemail legs'
    pushlist 'hatch_items' 'platemail gorget'
    pushlist 'hatch_items' 'platemail gloves'

    # CHAINMAIL SET
    pushlist 'hatch_items' 'chainmail coif'
    pushlist 'hatch_items' 'chainmail tunic'
    pushlist 'hatch_items' 'chainmail arms'
    pushlist 'hatch_items' 'chainmail leggings'
    pushlist 'hatch_items' 'chainmail gorget'
    pushlist 'hatch_items' 'chainmail gloves'

    # CHAINMAIL SET
    pushlist 'hatch_items' 'ringmail tunic'
    # sleeves
    pushlist 'hatch_items' 'ringmail sleeves'
    pushlist 'hatch_items' 5103
    pushlist 'hatch_items' 'ringmail leggings'
    pushlist 'hatch_items' 'ringmail gorget'
    pushlist 'hatch_items' 'ringmail gloves'

    # INSTRUMENTS
    pushlist 'hatch_items' 'bamboo flute'
    pushlist 'hatch_items' 'lute'
    pushlist 'hatch_items' 'drum'
    # tambourine doenst work with name appearantly
    pushlist 'hatch_items' 3742
    pushlist 'hatch_items' 'tambourine'
    pushlist 'hatch_items' 'lap harp'

    # MISC & MAGERY SCROLLS
    pushlist 'hatch_items' 'clean bandage%s%'
    pushlist 'hatch_items' 'arrow'
    # bolt doenst work with name appearantly
    pushlist 'hatch_items' 7163
    pushlist 'hatch_items' 'crossbow bolt'


    # REAGENTS
    pushlist 'hatch_items' 'Blood Moss'
    pushlist 'hatch_items' 'Black Pearl%s%'
    pushlist 'hatch_items' 'Garlic'
    pushlist 'hatch_items' 'Mandrake Root%s%'
    pushlist 'hatch_items' 'Ginseng'
    pushlist 'hatch_items' 'Nightshade'
    pushlist 'hatch_items' 'Sulfurous Ash'
    pushlist 'hatch_items' "Spider's Silk"


    pushlist 'hatch_items' 'Recall Scroll'
    pushlist 'hatch_items' 'ManaDrain Scroll'
    pushlist 'hatch_items' 'Greater Heal Scroll'
    pushlist 'hatch_items' 'Lightning Scroll'
endif






###################################
# SEARCH FOR HATCHS IN GROUND
###################################

unsetvar! hatch

# check if hatch nearby is already opened
if findtype 'hatch' ground any any 2 as found
    sysmsg 'FOUND HATCH' 90
    setvar! hatch found
endif


# search for hatchs in the ground to start the whole process
if not varexist hatch
    overhead 'NO HATCHES NEARBY!' 43
    sysmsg 'Cant find any ship hatches nearby!' 43
    stop
endif


###################################
# START LOOTING HATCH
###################################

clearsysmsg

sysmsg 'RECALLING BOARDING PARTY' 54
say '[recallboardingparty'

if findtype 15947|28116|15952|15947|15955|15950|14421 ground as enemyTiller
    if enemyTiller = tillerguy
        #overhead "Found my guy!"
    elseif enemyTiller = shipStatusBar
        #nothing
    else
        dclick enemyTiller
        wait 100
    endif
    @ignore enemyTiller
endif
clearignore

if varexist hatch
    sysmsg 'Looting hatch...' 53

    clearsysmsg
    dclick hatch
    wait action_delay

    while insysmsg 'you must wait'
        sysmsg 'Opening hatch...' 53
        clearsysmsg
        dclick hatch
        wait action_delay
    endwhile

    if varexist CHAR_LOOT_POUCH
        setvar! destination_container CHAR_LOOT_POUCH
    else
        setvar! destination_container backpack
    endif

    hotkey "Set Grab Item HotBag"
    wft action_delay
    target destination_container

    sysmsg 'SEARCHING RARES...' 54
    # 5901 - sandals
    # 48407 - ???
    while findtype 17686|4026|5901|48407|3821|2539|45315|17087|3985|3836|29833|42517|29040|52615|17083|5356|48261|8826|3827|29030|29036|5090|3834|2539|3856|3742|3861|3862|5060|7179|45315|7177|3877|5205|5042|22187|5123|5105|3865|5089|5106|7035|3934|7031|3859|3903|7029|5063|5078|22326|2545|5070|3740|5076|5129|5146|5139|5061|5059|3885|3913|5125|3617|7163|5121|3719|7173|5179|7034|7033|3917|5203|7610|3573|5074|5204|3878|3920|5117|3911|5056|5143|3721|3762|5201|5085|10245|5103|5177|5119|5046|7027|5040|3932|5131|7181|5127|5132|5135|7169|3713|3937|3873|7175|3854|5101|5185|5207|4225|5182|3763|3909|5049|3938|3568|5115|9917|8012|5142|7170|5187|3915|39891|5138|5181|7026|29971|3191|5112|5044 hatch as found

        #getlabel found item_label
        sysmsg '>>> LOOTING {{item_label}}...' 53

        #if 'Link' in item_label
        #    overhead 'found a link: {{item_label}}' 51 'self'
        #    sysmsg 'FOUND A LINK: {{item_label}}' 51
        #endif


        hotkey 'Grab Item'
        wft 600
        target found

        wait 100
        while queued
            wait 20
        endwhile

        # check char container limit
        if insysmsg 'That container cannot hold more weight'
            if timer 'char_heavy_warning_msg_timer' >= 5000
                overhead 'BACKPACK FULL! UNLOAD!' 37
                settimer 'char_heavy_warning_msg_timer' 0
            endif
        endif

        @ignore found
    endwhile

    while findtype 17087|3985|3836|29833|42517|29040|52615|17083|5356|48261|8826|3827|29030|29036 hatch as found

        getlabel found item_label
        sysmsg '>>> LOOTING {{item_label}}...' 53

        if 'Link' in item_label
            overhead 'found a link: {{item_label}}' 51 'self'
            sysmsg 'FOUND A LINK: {{item_label}}' 51
        endif

        if varexist CHAR_LOOT_POUCH
            setvar! destination_container CHAR_LOOT_POUCH
        else
            setvar! destination_container backpack
        endif

        hotkey "Set Grab Item HotBag"
        wft action_delay
        target destination_container

        hotkey 'Grab Item'
        wft 600
        target found

        wait 100
        while queued
            wait 20
        endwhile

        # check char container limit
        if insysmsg 'That container cannot hold more weight'
            if timer 'char_heavy_warning_msg_timer' >= 5000
                overhead 'BACKPACK FULL! UNLOAD!' 37
                settimer 'char_heavy_warning_msg_timer' 0
            endif
        endif

        @ignore found
    endwhile

    sysmsg 'SEARCHING GOLD, DOUBLOONS AND BOOTY...' 54
    while findtype 3821|2539|45315 hatch as found
        getlabel found item_label
        sysmsg '>>> LOOTING {{item_label}}...' 53

        hotkey "Set Grab Item HotBag"
        wft action_delay
        target destination_container

        hotkey 'Grab Item'
        wft 600
        target found

        wait 100
        while queued
            wait 20
        endwhile

        # check char container limit
        if insysmsg 'That container cannot hold more weight'
            if timer 'char_heavy_warning_msg_timer' >= 5000
                overhead 'BACKPACK FULL! UNLOAD!' 37
                settimer 'char_heavy_warning_msg_timer' 0
            endif
        endif

        @ignore found
    endwhile

    sysmsg 'SEARCHING COMMON hatch ITEMS...' 54
    while findtype 5090|3834|2539|3856|3742|3861|3862|5060|7179|45315|7177|3877|5205|5042|22187|5123|5105|3865|5089|5106|7035|3934|7031|3859|3903|7029|5063|5078|22326|2545|5070|3740|5076|5129|5146|5139|5061|5059|3885|3913|5125|3617|7163|5121|3719|7173|5179|7034|7033|3917|5203|7610|3573|5074|5204|3878|3920|5117|3911|5056|5143|3721|3762|5201|5085|10245|5103|5177|5119|5046|7027|5040|3932|5131|7181|5127|5132|5135|7169|3713|3937|3873|7175|3854|5101|5185|5207|4225|5182|3763|3909|5049|3938|3568|5115|9917|8012|5142|7170|5187|3915|39891|5138|5181|7026|29971|3191|5112|5044 hatch as found
        getlabel found item_label
        sysmsg '>>> LOOTING {{item_label}}...' 53

        hotkey "Set Grab Item HotBag"
        wft action_delay
        target destination_container

        hotkey 'Grab Item'
        wft 600
        target found

        wait 100
        while queued
            wait 20
        endwhile

        # check char container limit
        if insysmsg 'That container cannot hold more weight'
            if timer 'char_heavy_warning_msg_timer' >= 5000
                overhead 'BACKPACK FULL! UNLOAD!' 37
                settimer 'char_heavy_warning_msg_timer' 0
            endif
        endif

        @ignore found
    endwhile

    sysmsg 'SEARCHING NEW EXPANSION BOWS hatch ITEMS...' 54
    while findtype 30990|31184|31186|30994 hatch as found
        getlabel found item_label
            sysmsg '>>> LOOTING {{item_label}}...' 53

        hotkey "Set Grab Item HotBag"
        wft action_delay
        target destination_container

        hotkey 'Grab Item'
        wft 600
        target found

        wait 100
        while queued
            wait 20
        endwhile

        # check char container limit
        if insysmsg 'That container cannot hold more weight'
            if timer 'char_heavy_warning_msg_timer' >= 5000
                overhead 'BACKPACK FULL! UNLOAD!' 37
                settimer 'char_heavy_warning_msg_timer' 0
            endif
        endif

        @ignore found
    endwhile

    sysmsg 'SEARCHING NEW EXPANSION INSTRUMENTS hatch ITEMS...' 54
    while findtype 20008|20010|20012|20016|20006 hatch as found
        getlabel found item_label
        sysmsg '>>> LOOTING {{item_label}}...' 53

        hotkey "Set Grab Item HotBag"
        wft action_delay
        target destination_container

        hotkey 'Grab Item'
        wft 600
        target found

        wait 100
        while queued
            wait 20
        endwhile

        # check char container limit
        if insysmsg 'That container cannot hold more weight'
            if timer 'char_heavy_warning_msg_timer' >= 5000
                overhead 'BACKPACK FULL! UNLOAD!' 37
                settimer 'char_heavy_warning_msg_timer' 0
            endif
        endif

        @ignore found
    endwhile


    sysmsg 'SEARCHING NEW EXPANSION STAFFS hatch ITEMS...' 54
    while findtype 31037|31025|31035|31045|31049|31017 hatch as found
        getlabel found item_label
        sysmsg '>>> LOOTING {{item_label}}...' 53

        hotkey "Set Grab Item HotBag"
        wft action_delay
        target destination_container

        hotkey 'Grab Item'
        wft 600
        target found

        wait 100
        while queued
            wait 20
        endwhile

        # check char container limit
        if insysmsg 'That container cannot hold more weight'
            if timer 'char_heavy_warning_msg_timer' >= 5000
                overhead 'BACKPACK FULL! UNLOAD!' 37
                settimer 'char_heavy_warning_msg_timer' 0
            endif
        endif

        @ignore found
    endwhile


    sysmsg 'SEARCHING NEW EXPANSION WEAPONS hatch ITEMS...' 54
    while findtype 30997|30991|31000|31001|30998|31188|30992|30989|30995|30999|31176|31190|31178|31182|31128 hatch as found
        getlabel found item_label
        sysmsg '>>> LOOTING {{item_label}}...' 53

        hotkey "Set Grab Item HotBag"
        wft action_delay
        target destination_container

        hotkey 'Grab Item'
        wft 600
        target found

        wait 100
        while queued
            wait 20
        endwhile

        # check char container limit
        if insysmsg 'That container cannot hold more weight'
            if timer 'char_heavy_warning_msg_timer' >= 5000
                overhead 'BACKPACK FULL! UNLOAD!' 37
                settimer 'char_heavy_warning_msg_timer' 0
            endif
        endif

        @ignore found
    endwhile

    sysmsg 'SEARCHING NEW EXPANSION ARMORS hatch ITEMS...' 54
    while findtype 31003|31191|31141|31010|31006|31130|3100|31012|310153|31140|31011|31008|31015 hatch as found
        getlabel found item_label
        sysmsg '>>> LOOTING {{item_label}}...' 53

        hotkey "Set Grab Item HotBag"
        wft action_delay
        target destination_container

        hotkey 'Grab Item'
        wft 600
        target found

        wait 100
        while queued
            wait 20
        endwhile

        # check char container limit
        if insysmsg 'That container cannot hold more weight'
            if timer 'char_heavy_warning_msg_timer' >= 5000
                overhead 'BACKPACK FULL! UNLOAD!' 37
                settimer 'char_heavy_warning_msg_timer' 0
            endif
        endif

        @ignore found
    endwhile

    sysmsg 'SEARCHING NEW EXPANSION SHIELDS hatch ITEMS...' 54
    while findtype 7109 hatch as found
        getlabel found item_label
            sysmsg '>>> LOOTING {{item_label}}...' 53

        hotkey "Set Grab Item HotBag"
        wft action_delay
        target destination_container

        hotkey 'Grab Item'
        wft 600
        target found

        wait 100
        while queued
            wait 20
        endwhile

        # check char container limit
        if insysmsg 'That container cannot hold more weight'
            if timer 'char_heavy_warning_msg_timer' >= 5000
                overhead 'BACKPACK FULL! UNLOAD!' 37
                settimer 'char_heavy_warning_msg_timer' 0
            endif
        endif

        @ignore found
    endwhile

    sysmsg 'SEARCHING REAGENTS...' 54
    while findtype 3980|3974|3963|3976|3973|3972|3962|3981 hatch as found
        getlabel found item_label
        sysmsg '>>> LOOTING {{item_label}}...' 53

        hotkey "Set Grab Item HotBag"
        wft action_delay
        target destination_container

        hotkey 'Grab Item'
        wft 600
        target found

        wait 100
        while queued
            wait 20
        endwhile

        # check char container limit
        if insysmsg 'That container cannot hold more weight'
            if timer 'char_heavy_warning_msg_timer' >= 5000
                overhead 'BACKPACK FULL! UNLOAD!' 37
                settimer 'char_heavy_warning_msg_timer' 0
            endif
        endif

        @ignore found
    endwhile

    sysmsg 'SEARCHING SCROLLS...' 54
    while findtype 8006|8005|8011|8009 hatch as found
        getlabel found item_label
        sysmsg '>>> LOOTING {{item_label}}...' 53

        hotkey "Set Grab Item HotBag"
        wft action_delay
        target destination_container

        hotkey 'Grab Item'
        wft 600
        target found

        wait 100
        while queued
            wait 20
        endwhile

        # check char container limit
        if insysmsg 'That container cannot hold more weight'
            if timer 'char_heavy_warning_msg_timer' >= 5000
                overhead 'BACKPACK FULL! UNLOAD!' 37
                settimer 'char_heavy_warning_msg_timer' 0
            endif
        endif

        @ignore found
    endwhile

    restock 10
    wft 550
    target hatch


    @clearignore
    @clearsysmsg

endif

sysmsg '>>> LOOT HATCHES FINISHED!' 53

########################################
# SEARCH SHIPS
########################################

if boating_mode == 1
    script 'ships\search-ships-loop'
endif




#################################
# CHANGELOG
#################################
#
# (unreleased)
# - Switches list config to setvar! variables
#
# v0.0.3
# - Removes the hiding part so it doenst stop char from starting
# - Checks if char has trap_loot_pouch and if so use it to hide the hatch loot
# - In case no trap_loot_pouch is found, use 'Grab' hotkey + wft to get hatch items
# - Handles cases when backpack too full to loot
# - Adds gump serial to all gumpresponse calls
# - Adds SEVERAL missing item types from items list
# - Loots opened hatchs if finds one on ground
# - Explodes hatch when finishes looting
# - Fixed gold lift amount (was 1, changed to 60000)
# - Reorganized rares list to priorize cloth > cores > skill scrolls
# - Fixed wrong variable name for action_delay that was resulting in lift and drop actions happening at the same time
#
# v0.0.2
# - Adds clearsysmsg at the beginning of the macro to avoid detecting sysmsgs from previous executions
#
# v0.0.1
# - Initial release
#
#
