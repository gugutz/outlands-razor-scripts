
setvar! action_delay 600

setvar! ship_main_gump_id 4216593270
setvar! max_distance_to_open_ship_gump 25

# if gump already open on start, just embark
if gumpexists 4216593270
    sysmsg 'GUMP FOUND! EMBARKING...'

    if followers > 0
        gumpresponse 202 4216593270
        waitforgump 4216593270 1000
    endif

    gumpresponse 201 4216593270
    waitforgump 4216593270 1000
    gumpclose 4216593270
    stop

endif

#clearsysmsg
#if not varexist embark_own_ship_first_run_done or not varexist SHIP_TILLERMAN
if not varexist SHIP_TILLERMAN
    overhead '*select ship tillerman*'
    setvar! SHIP_TILLERMAN
endif

#if not varexist embark_own_ship_first_run_done or not varexist SHIP_HULL_STATUS_BAR
if not varexist SHIP_HULL_STATUS_BAR
    overhead '*select ship hull statusbar*'
    setvar! SHIP_HULL_STATUS_BAR
endif


#if not find SHIP_TILLERMAN ground any any and not find SHIP_HULL_STATUS_BAR ground any any
#    overhead '*cant find tillerman and statubar!*'
#    sysmsg 'CANT FIND TILLERMAN OR SHIP STATUSBAR TO EMBARK!' 54
#    setvar! SHIP_TILLERMAN
#endif
#
#if not find SHIP_HULL_STATUS_BAR ground any any
#    overhead '*tillerman not found!*'
#    setvar! SHIP_TILLERMAN
#endif
#
# this has to be here, cant detect this msg after it happens cause the script stops when this msg appears, its an error
if insysmsg 'invalid serial'
    overhead 'PEGOU RAZOR INVALID MSG'
    unsetvar! SHIP_TILLERMAN
    unsetvar! SHIP_HULL_STATUS_BAR
    replay
endif


// try ship tillerman first
if varexist SHIP_TILLERMAN
    sysmsg 'CLICKING TILLERMAN...' 54
    clearsysmsg
    dclick SHIP_TILLERMAN

    waitforgump 4216593270 action_delay

    if insysmsg 'invalid serial'
        sysmsg 'PEGOU RAZOR INVALID MSG'
        unsetvar! SHIP_TILLERMAN
        #replay
    endif
    if insysmsg 'World saving'
        sysmsg 'WORLD SAVE DETECTED! WAITING...'
        while not insysmsg 'complete!'
            wait 100
        endwhile
    endif

    if not gumpexists 4216593270
        overhead '*ship gump not found! trying statusbar*'
    endif
else
    sysmsg  'SHIP TILLER MAN NOT FOUND. TRYING STATUSBAR...'
endif


// try ship statusbar if tillerman fails
if not gumpexists 4216593270
    if varexist SHIP_HULL_STATUS_BAR
        sysmsg 'CLICKING HULL STATUS BAR...' 54
        clearsysmsg
        dclick SHIP_HULL_STATUS_BAR

        waitforgump 4216593270 action_delay

        if insysmsg 'invalid serial'
            sysmsg 'PEGOU RAZOR INVALID MSG'
            unsetvar! SHIP_HULL_STATUS_BAR
            #replay
        endif
        if insysmsg 'World saving'
            sysmsg 'WORLD SAVE DETECTED! WAITING...'
            while not insysmsg 'complete!'
                wait 100
            endwhile
        endif

        if not gumpexists 4216593270
            overhead '*ship gump not found! replaying*'
            sysmsg 'COULDNT OPEN SHIP GUMP TO EMBARK. UNSETTING VARS AND REPLAYING...'
            unsetvar! SHIP_TILLERMAN
            unsetvar! SHIP_HULL_STATUS_BAR
            replay
        endif
    else
        sysmsg  'SHIP HULL STATUSBAR NOT FOUND. EMBARK MANUALLY'
    endif
endif

if gumpexists 4216593270
    if followers > 0
        gumpresponse 202 4216593270
        waitforgump 4216593270 1000
    endif

    sysmsg 'EMBARKING OWN SHIP...' 54
    gumpresponse 201 4216593270
    waitforgump 4216593270 1000
    gumpclose 4216593270

endif

setvar! embark_own_ship_first_run_done 1
