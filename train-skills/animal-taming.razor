#################################
# CREDITS :)
#################################
sysmsg '#########################' 90
sysmsg '>>> ANIMAL TAMING TRAINING SCRIPT' 55
sysmsg 'by gugutz' 45
sysmsg 'version 0.0.1' 31
sysmsg '########################' 90


#################################
# IN GAME INSTRUCTIONS / OBSERVATIONS
#################################
sysmsg '************************' 90
sysmsg 'FOR THIS SCRIPT TO WORK PROPERLY, YOU MUST:' 53
sysmsg " > Have one or more tank pet!" 55
sysmsg "." 0
sysmsg " > Recommended tank pets:" 55
sysmsg " > 50 - 72.5  skill: use Rock Guar" 55
sysmsg " > 75 - 102.5 skill: use Scarab" 55
sysmsg " > 105 - 120  skill: use Sand Roach" 55
sysmsg '***********************' 90



#################################
# CREATE ALL LISTS FOR CONFIG
#################################


if not listexists 'animal_taming_config_lists'
    createlist 'animal_taming_config_lists'

    # routine-related lists
    pushlist 'animal_taming_config_lists' 'action_delay'
    pushlist 'animal_taming_config_lists' 'healing_bandage_delay'
    pushlist 'animal_taming_config_lists' 'vet_bandage_delay'
    pushlist 'animal_taming_config_lists' 'script_running_warning_msg_delay'
    pushlist 'animal_taming_config_lists' 'find_tameables_range'
    pushlist 'animal_taming_config_lists' 'max_taming_level'
    pushlist 'animal_taming_config_lists' 'searching_tameables_msg_warning_delay'

    pushlist 'animal_taming_config_lists' 'player_tank_pets'
    pushlist 'animal_taming_config_lists' 'animal_lore_gump_id'


    foreach list in 'animal_taming_config_lists'
        if not listexists list
            createlist list
        endif
    endfor


    ################################
    # SCRIPT CONFIGURATION
    ################################

    pushlist 'action_delay' 600
    pushlist 'vet_bandage_delay' 8000
    pushlist 'script_running_warning_msg_delay' 8000
    pushlist 'find_tameables_range' 10
    pushlist 'max_taming_level' 120
    pushlist 'searching_tameables_msg_warning_delay' 2000
    pushlist 'animal_lore_gump_id' 3280914284

    #################################
    # CREATE ALL TIMERS
    #################################

    if not listexists 'animal_taming_timers'
        createlist 'animal_taming_timers'
        pushlist 'animal_taming_timers' 'loop_on_warning_msg'
        pushlist 'animal_taming_timers' 'taming_timer'
        pushlist 'animal_taming_timers' 'running_script_warning_timer'
        pushlist 'animal_taming_timers' 'healing_bandage_timer'
        pushlist 'animal_taming_timers' 'vet_bandage_timer'
        pushlist 'animal_taming_timers' 'searching_tameables_msg_timer'

        foreach timer in 'animal_taming_timers'
            if not timerexists timer
                createtimer timer
                settimer timer 99999
            endif
        endfor
    endif
endif





#################################
# INITIALIZE THE CONFIGURATION VALUES AS VARIABLES BUT FROM LIST SO WE DONT NEED TO ITERATE TO GET THE INDEX 0
if atlist 'action_delay' 0 as action_delay
if atlist 'healing_bandage_delay' 0 as healing_bandage_delay
if atlist 'vet_bandage_delay' 0 as vet_bandage_delay
if atlist 'script_running_warning_msg_delay' 0 as script_running_warning_msg_delay
if atlist 'find_tameables_range' 0 as find_tameables_range
if atlist 'max_taming_level' 0 as max_taming_level
if atlist 'searching_tameables_msg_warning_delay' 0 as searching_tameables_msg_warning_delay
if atlist 'animal_lore_gump_id' 0 as animal_lore_gump_id



###############################################################
# TANK_PETS
#
if not listexists 'tank_pets'
    sysmsg '>>> CREATING TANK TRAINING_PETS LITS...' 74
    @createlist 'tank_pets'
    #lemura
    @pushlist 'tank_pets' 293
    # Drake grey body
    pushlist 'tank_pets' 60
    # Drake red body
    pushlist 'tank_pets' 61
    # Acarid
    pushlist 'tank_pets' 385
    # Drake grey body
    pushlist 'tank_pets' 60
    # Drake red body
    pushlist 'tank_pets' 61
    # Aegis Minion
    pushlist 'tank_pets' 776
    # or Sphinx
    pushlist 'tank_pets' 293
    #Cave Bear
    pushlist 'tank_pets' 213
    #Scarab
    pushlist 'tank_pets' 169
    # Drake Whelp
    pushlist 'tank_pets' 718
    # or Aegis Slime
    pushlist 'tank_pets' 51
    # Deep Crawler
    pushlist 'tank_pets' 315
    # Drake red body
    pushlist 'tank_pets' 61
    # Drake grey body
    pushlist 'tank_pets' 60
    # Dragon whelp
    pushlist 'tank_pets' 718
    # Husk Crab
    pushlist 'tank_pets' 729
    # or Dragon grey body
    pushlist 'tank_pets' 12
    # or Dragon red body
    pushlist 'tank_pets' 59
    # Snow Drift
    pushlist 'tank_pets' 51
    # Grey Dragon body value
    pushlist 'tank_pets' 12
    # Red Dragon body value
    pushlist 'tank_pets' 59
    # or Colossal Sandroach
    pushlist 'tank_pets' 388
endif


##########################################################
# BOOTSTRAPING

# SET TANK PET WHEN NEEDED OR TANK IS SET BUT NOT FOUND NEARBY
if not varexist tank
    overhead 'Please select your tanking pet'
    setvar tank
elseif varexist tank and not find tank
    overhead 'Please select your tanking pet'
    setvar tank
endif

# AUTO FIND TANK PET (USUALLY SCARAB)
foreach pet in 'tank_pets'
    # using 5 here cause thats the max ammount of training_pets of the same graphic a player can have
    while findtype pet ground any 5 find_pet_range as pet
        if noto pet = friend and not inlist 'player_tank_pets' pet
            overhead 'found tank pet!' 55 pet
            @pushlist 'player_tank_pets' pet
            # ignore for now so razor cant find it anymore and we can leave the while loop
            @ignore pet
        endif
    endwhile
endfor
@clearignore



sysmsg ">>> STARTING ANIMAL TAMING TRAINING SCRIPT..." 56
pause 1000

##################################
# MAIN ROUTINE

while skill 'taming' < max_taming_level

    # warn every X (pre-set) seconds the script is running
    if timer 'running_script_warning_timer' > script_running_warning_msg_delay
        sysmsg '>>> RUNNING ANIMAL TAMING SCRIPT...' 55
        settimer 'running_script_warning_timer' 0
    endif


    ####################################
    # MONITOR AND MAINTAIN CHAR HEALTH
    ####################################

    if diffhits > 0
        sysmsg 'LOST HP! ASSUMING CHAR IS UNDER ATTACK AND GUARDING WITH PETS'
        say 'all guard me'

        # heal with pots
        if diffhits > 20
            if findtype 'yellow potion' backpack
                hotkey 'Drink Heal'
                wait action_delay_var
            endif
        endif

        # heal with healing
        if diffhits > 10 and skill 'healing' >= 20
            if timer 'healing_bandage_timer' >= bandage_delay
                settimer 'healing_bandage_timer' 0
                hotkey 'Bandage Self'
            endif
        # heal with magery
        elseif diffhits > 20 and skill 'magery' >= 50 and mana >= 11
            cast 'greater heal'

            @settimer 'waiting_target_timer' 0
            while not targetexists 'beneficial' and timer 'waiting_target_timer' < 3500
                wait 100
                if insysmsg 'disturbed' or insysmsg 'cannot cast a spell while frozen'
                    sysmsg 'BREAKING WHILE WAITING FOR GREATER HEAL TARGET'
                    break
                endif
            endwhile

            if targetexists 'beneficial'
                hotkey 'Target Self'
            endif
        endif

        wait 2000
        say 'all follow me'
        wait action_delay
    endif


    ####################################
    # KEEP HEALING ALL TANKS ROUTINE
    ####################################

    if timer 'vet_bandage_timer' >= vet_bandage_delay
        foreach tank_pet in 'player_tank_pets'
            getlabel tank_pet tank_pet_label

            if findtype 'clean bandage%s%' backpack any any as bands
                useobject bands
                wft action_delay
                target tank_pet
                wait action_delay

                if insysmsg 'not damaged'
                    overhead '*not damaged. skipping to next pet*' 52 tank_ket
                    sysmsg '*{{tank_pet_label}} not damaged. Skipping to next pet*' 52
                    break
                elseif insysmsg 'You being applying the bandages...'
                    sysmsg '>>> HEALING {{tank_pet_label}}' 60
                    sysmsg '*healing*' 90 tank_pet
                    settimer 'vet_bandage_timer' 0
                endif
            else
                overhead 'NO BANDAGES!!!' 39
                break
            endif
        endfor
    endif

    ################################
    # RECREATE TRANING PET LIST EVERY TIME TO KEEP TRACK
    # OF CHAR TAMING SKILL AND AVOID WASTING TIME ON WRONG PETS
    @removelist 'training_pets'
    @createlist 'training_pets'

    if skill 'taming' < 60 # At 50 taming
        # Frog
        pushlist 'training_pets' '80'
    elseif skill 'taming' < 70 # At 60 taming
        #Cave Bear
        pushlist 'training_pets' '213'
    #Scarab
    elseif skill 'taming' < 75 # At 70 taming
        pushlist 'training_pets' '169'
    elseif skill 'taming' < 80 # At 75 taming
        # Drake Whelp
        pushlist 'training_pets' '718'
        # or Aegis Slime
        pushlist 'training_pets' '51'
    elseif skill 'taming' < 85 # At 80 taming
        # Deep Crawler
        pushlist 'training_pets' '315'
    elseif skill 'taming' < 90 # At 85 taming
        # Drake red body
        pushlist 'training_pets' '61'
        # Drake grey body
        pushlist 'training_pets' '60'
        # Dragon whelp
        pushlist 'training_pets' '718'
    elseif skill 'taming' < 95 # At 90 taming
        # Husk Crab
        pushlist 'training_pets' '729'
    elseif skill 'taming' < 100 # At 95 taming
        # or Dragon grey body
        pushlist 'training_pets' '12'
        # or Dragon red body
        pushlist 'training_pets' '59'

    elseif skill 'taming' < 105 # At 100 taming
        # Snow Drift
        pushlist 'training_pets' '51'
    # At 105 taming, Earth Drake
    elseif skill 'taming' < 110
        # Drake grey body
        pushlist 'training_pets' '60'
        # Drake red body
        pushlist 'training_pets' '61'
        # Acarid
        #pushlist 'training_pets' '385'
    elseif skill 'taming' < 115 # At 110 taming
        # Drake grey body
        pushlist 'training_pets' '60'
        # Drake red body
        pushlist 'training_pets' '61'

        # Aegis Minion
        pushlist 'training_pets' '776'
        # or Sphinx
        pushlist 'training_pets' '293'
    elseif skill 'taming' < 120 # At 115 taming, Earth Dragon
        # Grey Dragon body value
        pushlist 'training_pets' '12'
        # Red Dragon body value
        pushlist 'training_pets' '59'
        # or Colossal Sandroach
        pushlist 'training_pets' '388'
    else
        overhead 'STOP! You have finished your journey'
        stop
    endif


    ###################################
    # MAIN ROUTINE
    # SEARCH FOR TAMEABLE PETS TO TRAIN
    ###################################

    foreach pet in training_pets
        if not findtype pet ground any any find_tameables_range
            if timer 'searching_tameables_msg_timer' >= searching_tameables_msg_warning_delay
                settimer 'searching_tameables_msg_timer' 0
                overhead '*searching tameables*' 55
                overhead 'Searching Tameables...' 55
            endif

        elseif findtype pet ground any any find_tameables_range as tameable
            overhead 'Found tameable! Luring...' 90
            overhead '*found tameable. luring*' 90 tameable
            getlabel tameable tameable_label

            ###################################
            # BEFORE TAMING ROUTINE
            ###################################

            while noto tameable != friend and noto tameable != friendly

                #-----------------------------------
                # MONITOR AND MAINTAIN CHAR HEALTH

                if diffhits > 0
                    sysmsg 'LOST HP! ASSUMING CHAR IS UNDER ATTACK AND GUARDING WITH PETS'
                    say 'all guard me'

                    # heal with pots
                    if diffhits > 20
                        if findtype 'yellow potion' backpack
                            hotkey 'Drink Heal'
                            wait action_delay_var
                        endif
                    endif

                    # heal with healing
                    if diffhits > 10 and skill 'healing' >= 20
                        if timer 'healing_bandage_timer' >= bandage_delay
                            settimer 'healing_bandage_timer' 0
                            hotkey 'Bandage Self'
                        endif
                    # heal with magery
                    elseif diffhits > 20 and skill 'magery' >= 50 and mana >= 11
                        cast 'greater heal'

                        @settimer 'waiting_target_timer' 0
                        while not targetexists 'beneficial' and timer 'waiting_target_timer' < 3500
                            wait 100
                            if insysmsg 'disturbed' or insysmsg 'cannot cast a spell while frozen'
                                sysmsg 'BREAKING WHILE WAITING FOR GREATER HEAL TARGET'
                                break
                            endif
                        endwhile

                        if targetexists 'beneficial'
                            hotkey 'Target Self'
                        endif
                    endif

                    wait 2000
                    say 'all follow me'
                    wait action_delay
                endif


                #-----------------------------------
                # KEEP HEALING ALL TANKS ROUTINE

                if timer 'vet_bandage_timer' >= vet_bandage_delay
                    foreach tank_pet in 'player_tank_pets'
                        getlabel tank_pet tank_pet_label

                        if findtype 'clean bandage%s%' backpack any any as bands
                            useobject bands
                            wft action_delay
                            target tank_pet
                            wait action_delay

                            if insysmsg 'not damaged'
                                overhead '*not damaged. skipping to next pet*' 52 tank_ket
                                sysmsg '*{{tank_pet_label}} not damaged. Skipping to next pet*' 52
                                break
                            elseif insysmsg 'You being applying the bandages...'
                                sysmsg '>>> HEALING {{tank_pet_label}}' 60
                                sysmsg '*healing*' 90 tank_pet
                                settimer 'vet_bandage_timer' 0
                            endif
                        else
                            overhead 'NO BANDAGES!!!' 39
                            break
                        endif
                    endfor
                endif


                #-----------------------------------
                # LURE TAMEABLE CLOSER IF NEEDED

                while not find tameable ground any any 2 or insysmsg 'too far away'
                    sysmsg 'LURING {{tameable_label}} CLOSER TO TAME...' 55
                    overhead 'luring mob closer...' 55
                    overhead 'luring closer...' 55 tameable
                    say 'all kill'
                    wft 1000
                    target tameable
                    pause 2000
                    say 'all follow me'
                endwhile

                if noto 'last' == friendly or noto 'last' == friend or noto 'last' == innocent
                    sysmsg 'CANCELING LAST TARGET BEFORE ALL KILL' 55
                    hotkey 'Cancel current target'
                endif

                #-----------------------------------
                # OPEN ANIMAL LORE GUMP FOR CURRENT PET

                if not gumpexists 3280914284
                    sysmsg '>>> OPENING {{tameable_label}} LORE GUMP...' 56
                    overhead '*opening lore gump*' 56 tameable
                    skill 'AnimalLore'
                    wft 600
                    @target tameable
                    waitforgump animal_lore_gump_id 600
                    wait 400

                    while not ingump 'Base' 3280914284
                        sysmsg ">> CHANGING GUMP PAGE TO 'Value vs Avg' VALUES" 56
                        gumpresponse 5
                        waitforgump animal_lore_gump_id 1000
                        wait 400
                    endif
                endif

                #-----------------------------------
                # TRY TO TAME PET

                # if timer 'taming_timer' > 13000
                if timer 'taming_timer' > 1000
                    useskill 'taming'
                    wft 600
                    if targetexists 'neutral'
                        @target 'last'
                        settimer 'taming_timer' 0
                    endif
                endif

            endwhile


            ###################################
            # AFTER TAMING ROUTINE
            ###################################

            # if systems asks who do we want to transfer ownership to, that means the pet is tamed and we call kill it to tame the next one
            if noto tameable == friend or noto tameable == innocent
                sysmsg '>> {{tameable_label}} TAMED. KILLING IT TO TAME THE NEXT ONE...' 40
                pushlist 'kill_current_tameable' 'yes'

            elseif insysmsg 'You have already received the maximum taming skill gain possible for this individual creature'
                sysmsg '>>> CANT GAIN FROM {{tameable_label}} ANYMORE. KILLING IT...' 40
                pushlist 'kill_current_tameable' 'yes'
            endif

            if inlist 'kill_current_tameable' 'yes'
                clearlist 'kill_current_tameable'
                while not dead tameable
                    sysmsg 'Killing tamed pet to release slot'
                    if hits < maxhits
                        hotkey '> Greater Heal/Cure Self'
                    endif
                    say 'all kill'
                    wft 1000
                    @target tameable
                    attack tameable
                    wait 2000
                endwhile
            endif

        clearsysmsg

    endfor
endwhile

sysmsg 'EXITING ANIMAL TAMING TRAINIG SCRIPT...' 54



################################
# CLOSE CONFIG 'if atlist' STATEMENTS
################################
endif
endif
endif
endif
endif
endif
endif


#################################
# CHANGELOG
#################################
#
# v0.0.1
# - Initial release
